````skill
---
name: tauri-installer-setup
description: Step-by-step guide for setting up a new Tauri v1 desktop app with React, TypeScript, Vite, Tailwind 4, and MSI installer packaging. Covers requirements, project scaffolding, proxy bundling, and final installer build.
---

# Tauri Installer Setup

Reference for bootstrapping a new desktop application that ships as a Windows MSI installer. Use this skill when:
- Starting a new project on the same stack (React + Vite + Tailwind + Tauri)
- Setting up MSI packaging for an existing web app
- Configuring a proxy-based offline architecture
- Reviewing installer build pipeline configuration

---

## Prerequisites

### Required Software

| Tool | Version | Purpose |
|------|---------|---------|
| **Node.js** | LTS (≥ 18) | JS runtime, build tooling, proxy server |
| **npm** | Bundled with Node | Package management |
| **Rust toolchain** | Stable (via `rustup`) | Tauri launcher compilation |
| **Tauri CLI** | 1.x (`@tauri-apps/cli`) | Dev/build commands for the desktop shell |
| **WiX Toolset** | 3.x | MSI installer generation (Windows only) |
| **pkg** | 5.x | Compile Node.js proxy into a standalone EXE |

> **Note:** On a fresh Windows machine, install the [Visual Studio C++ Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/) (required by Rust/Tauri).

See [references/build-pipeline.md](./references/build-pipeline.md) for prerequisite verification commands.

---

## Architecture Overview

```
┌──────────────────────────────────────────────────┐
│                  MSI Installer                   │
│  (WiX — generated by `tauri build`)              │
├──────────────────────────────────────────────────┤
│                                                  │
│  ┌────────────────┐   ┌───────────────────────┐  │
│  │  Launcher EXE  │   │   Bundled Resources   │  │
│  │  (Tauri/Rust)  │   │                       │  │
│  │                │   │  ┌─────────────────┐  │  │
│  │  • Pick port   │   │  │  proxy.exe      │  │  │
│  │  • Spawn proxy │   │  │  (Node via pkg) │  │  │
│  │  • Health wait │   │  └─────────────────┘  │  │
│  │  • Open browser│   │  ┌─────────────────┐  │  │
│  │  • Kill on exit│   │  │  web/           │  │  │
│  └────────────────┘   │  │  (Vite build)   │  │  │
│                       │  └─────────────────┘  │  │
│                       └───────────────────────┘  │
└──────────────────────────────────────────────────┘
```

**Flow:** User launches EXE → Launcher picks an available port → Spawns `proxy.exe` with env vars → Waits for `/health` → Opens default browser → Runs until exit → Kills proxy on shutdown.

### Core Concepts

| Concept | Description |
|---------|-------------|
| **Headless launcher** | Tauri window is invisible (`visible: false`). The app opens in the user's default browser, not a webview. |
| **Proxy-as-EXE** | The Node.js Express server is compiled to a standalone `.exe` via `pkg`, eliminating the Node runtime dependency for end users. |
| **Health-gated launch** | The launcher polls `GET /health` before opening the browser. This prevents the user from seeing a blank page while the proxy boots. |
| **Dynamic port selection** | The launcher scans ports starting at 5174 and picks the first available one, avoiding conflicts. |
| **Resource bundling** | `tauri.conf.json` declares which files ship inside the MSI. The installer extracts them to the install directory on the user's machine. |
| **Graceful shutdown** | On `ExitRequested`, the launcher kills the proxy child process to avoid orphaned servers. |

---

## Step-by-Step Setup

### Phase 1 — Scaffold the Frontend

**Goal:** Working React + TypeScript + Vite + Tailwind 4 app.

**Steps:**

1. **Create Vite project** with the `react-ts` template.
2. **Install Tailwind CSS 4** — requires `tailwindcss`, `@tailwindcss/postcss`, `postcss`, `autoprefixer`.
3. **Configure PostCSS** — single plugin entry: `@tailwindcss/postcss`.
4. **Configure Tailwind** — set `content` globs to cover `index.html` and `src/**/*.{js,ts,jsx,tsx}`.
5. **Add Tailwind directive** — `@import "tailwindcss"` in `src/index.css`.
6. **Configure path aliases** — `@/*` → `./src/*` in both `tsconfig.app.json` (paths) and `vite.config.ts` (resolve.alias).
7. **Add Vitest** — `jsdom` environment, setup file importing `@testing-library/jest-dom`.
8. **Add ESLint** — TypeScript + React Hooks + React Refresh plugins.

**Standards:**
- Path alias `@/` is mandatory for all imports from `src/`.
- Test setup file lives at `src/test/setup.ts`.
- Tailwind config must cover all file extensions used in the project.

See [references/frontend-scaffolding.md](./references/frontend-scaffolding.md) for all config file templates and install commands.

---

### Phase 2 — Build the Proxy Server

**Goal:** Express-based local proxy that also serves static files in production.

**Responsibilities of the proxy:**

1. **API forwarding** — `GET /api/proxy?url=...` fetches from allowed external hosts and returns the response. An allowlist prevents misuse.
2. **Health endpoint** — `GET /health` returns `{ status: 'ok' }`. This is the contract the Tauri launcher depends on.
3. **Static serving** — When `SERVE_STATIC=true`, the proxy serves the Vite build output and handles SPA fallback (all non-`/api/` routes → `index.html`).

**Configuration is env-driven** — port, host, static dir are all read from environment variables so the Tauri launcher can control them at spawn time.

**Development workflow:**
- Vite dev server runs on `:5173`, proxy on `:5174`.
- Vite's built-in proxy forwards `/api` requests to the proxy during development.
- `concurrently` runs both servers in parallel with a single `dev:all` script.

**Standards:**
- The `/health` endpoint is **mandatory** — removing it breaks the launcher.
- The proxy allowlist must be strict — only permit known external hostnames.
- Never embed API secrets in source; use runtime config (env vars or AppData files).

See [references/proxy-server-template.md](./references/proxy-server-template.md) for the proxy code template, Vite proxy config, and env variable reference.

---

### Phase 3 — Initialize Tauri

**Goal:** Tauri shell that wraps the built frontend + proxy into a desktop app.

**Steps:**

1. **Install Tauri CLI** as a dev dependency (`@tauri-apps/cli`).
2. **Run `npx tauri init`** to scaffold `src-tauri/` with config, Cargo project, and icons.
3. **Configure `tauri.conf.json`** — set bundle targets to `["msi"]`, declare resource paths, and set the window to invisible.
4. **Configure `Cargo.toml`** — Tauri feature flags must mirror the `allowlist` entries in `tauri.conf.json`.
5. **Write the launcher** (`src-tauri/src/main.rs`) — the Rust binary that orchestrates startup and shutdown.

**Launcher lifecycle:**

```
1. Resolve bundled resource paths (proxy.exe, web/)
2. Pick an available port (scan from 5174, skip occupied)
3. Spawn proxy.exe with env vars (PROXY_PORT, STATIC_DIR)
4. Poll /health until proxy is ready (10s timeout)
5. Open default browser to http://127.0.0.1:{port}/
6. On exit: kill the proxy child process
```

**Key configuration rules:**

| Field | Standard |
|-------|----------|
| `bundle.targets` | Must be `["msi"]` for Windows MSI output |
| `bundle.resources` | Must include both `proxy.exe` path and `web/` directory |
| `bundle.icon` | Path to `.ico` — used by the installer and desktop shortcut |
| `windows[0].visible` | `false` — the launcher is headless, browser is the UI |
| `allowlist.shell.open` | Required — enables `tauri::api::shell::open` for browser launch |
| `allowlist.dialog.message` | Required — enables user-facing error dialogs on startup failure |
| Cargo `features` | Must match `allowlist` — e.g., `"dialog-message"` + `"shell-open"` |

**Recommended launcher additions:**
- Logging to `app_log_dir()` for diagnostics.
- Health check with timeout and a user-facing error dialog on failure.
- Panic hook that writes to log file for crash forensics.

See [references/tauri-config-templates.md](./references/tauri-config-templates.md) for `tauri.conf.json`, `Cargo.toml`, `main.rs`, and the resource preparation script.

---

### Phase 4 — Resource Preparation

**Goal:** Automate copying the Vite build output into Tauri's resource directory before the installer is built.

**Concept:** Tauri bundles files from `src-tauri/resources/` into the MSI. A preparation script bridges the gap between `npm run build` (which outputs to `dist/`) and what Tauri expects.

**The script must:**
1. Verify `dist/` exists (fail fast if the frontend hasn't been built).
2. Clean the target directory (`src-tauri/resources/web/`) to avoid stale files.
3. Recursively copy `dist/` → `src-tauri/resources/web/`.

See [references/tauri-config-templates.md](./references/tauri-config-templates.md) for the script implementation.

---

### Phase 5 — Build Pipeline

**Goal:** Single command that produces the MSI installer.

**The `build:tauri` script chains four steps:**

| Step | Script | What it does | Output |
|------|--------|--------------|--------|
| 1 | `build` | TypeScript check + Vite production build | `dist/` |
| 2 | `build:proxy` | Compile proxy to standalone EXE via `pkg` | `src-tauri/resources/proxy/proxy.exe` |
| 3 | `prepare:tauri` | Copy `dist/` into Tauri resources | `src-tauri/resources/web/` |
| 4 | `tauri build --bundles msi` | Rust compilation + WiX MSI packaging | `src-tauri/target/release/bundle/msi/*.msi` |

**Standards:**
- Steps must run in this exact order — each depends on the previous output.
- The `pkg` `--targets` flag must match the deployment OS (e.g., `node18-win-x64` for Windows).
- The final MSI lands in `src-tauri/target/release/bundle/msi/`.

See [references/build-pipeline.md](./references/build-pipeline.md) for all build scripts, the full sequence diagram, and output locations.

---

## Common Pitfalls

| Pitfall | Symptom | Fix |
|---------|---------|-----|
| Missing WiX on PATH | `tauri build` fails at MSI step | Install WiX 3.x, add to system PATH |
| Mismatched Tauri features | Runtime panic or missing API | `Cargo.toml` features must match `tauri.conf.json` allowlist |
| Proxy not bundled | App opens browser but page is blank | Ensure `resources` array in `tauri.conf.json` includes `proxy.exe` |
| Port already in use | Proxy fails to start | Implement port scanning (try next port) |
| No `/health` endpoint | Launcher times out | Add `GET /health` returning `{ status: 'ok' }` |
| `pkg` targets wrong platform | EXE won't run | Match `--targets` to deployment OS (e.g., `node18-win-x64`) |
| Static assets not copied | Blank page after install | Run `prepare:tauri` after `vite build`, before `tauri build` |
| Secrets in installer | API keys exposed in MSI | Move credentials to runtime config in AppData |

---

## Quick Reference — Minimal File Tree

```
my-app/
├── package.json
├── vite.config.ts
├── tsconfig.json
├── tsconfig.app.json
├── tsconfig.node.json
├── tailwind.config.js
├── postcss.config.js
├── eslint.config.js
├── index.html
├── src/                        # React + TypeScript frontend
│   ├── main.tsx
│   ├── App.tsx
│   ├── index.css               # Tailwind directives
│   └── test/
│       └── setup.ts
├── server/
│   └── proxy.cjs               # Express proxy (builds to EXE)
├── scripts/
│   └── prepare-tauri-resources.cjs
└── src-tauri/
    ├── tauri.conf.json
    ├── Cargo.toml
    ├── build.rs
    ├── icons/
    │   └── icon.ico
    ├── resources/               # Populated at build time
    │   ├── proxy/
    │   │   └── proxy.exe
    │   └── web/
    │       └── (vite build output)
    └── src/
        └── main.rs              # Rust launcher
```

---

## Adapting for a Different Project

To reuse this architecture for a new application:

1. **Replace the frontend:** Swap `src/` contents with your own React app. Keep `index.html`, `vite.config.ts`, and Tailwind config intact.
2. **Replace the proxy routes:** Edit `server/proxy.cjs` to forward your own API endpoints. Keep the `/health` endpoint.
3. **Update identifiers:** Change `productName`, `identifier`, and `version` in `tauri.conf.json`.
4. **Update icons:** Replace `src-tauri/icons/icon.ico` with your own.
5. **Adjust port range:** Change the `pick_port` start value in `main.rs` if needed.
6. **Secrets management:** Store API keys and config in user's AppData, never in the installer bundle.

> **Rule:** The launcher Rust code rarely needs changes — it is a generic "start proxy, open browser, clean up" shell. All app-specific logic stays in the frontend and the proxy.

---

## Verification Checklist

See [references/build-pipeline.md](./references/build-pipeline.md) for the full verification checklist with commands.

| Check | Passes? |
|-------|---------|
| Frontend builds cleanly | |
| Tests pass | |
| Linting clean | |
| Proxy EXE compiles | |
| Resources copied | |
| MSI builds | |
| Fresh install works on clean machine | |
| App opens in browser from desktop shortcut | |
| Health check responds | |
| Proxy routes work end-to-end | |
| Uninstall leaves no Program Files artifacts | |

---

## Reference Files

| File | Contents |
|------|----------|
| [references/frontend-scaffolding.md](./references/frontend-scaffolding.md) | Vite, Tailwind 4, TypeScript, Vitest, ESLint — install commands and config templates |
| [references/proxy-server-template.md](./references/proxy-server-template.md) | Express proxy code, Vite dev proxy config, env variable reference |
| [references/tauri-config-templates.md](./references/tauri-config-templates.md) | `tauri.conf.json`, `Cargo.toml`, `main.rs` launcher, resource preparation script |
| [references/build-pipeline.md](./references/build-pipeline.md) | Build scripts, full sequence diagram, output locations, verification commands |
````
